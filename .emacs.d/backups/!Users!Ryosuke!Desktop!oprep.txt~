コンピュータの動作中、
電源をいきなり落とすとなぜまずいのか。
NIXとWINDOWSの違いがあるのはなぜか。

ライトバック
ライトスルー

## プロンプトフォーマットを展開した後の文字数を返す。
## 日本語未対応。
countPChars(){
    print -n -P -- "$1" | sed -e $'s/\e\[[0-9;]*m//g' | wc -m | sed -e 's/ //g'
}

update_prompt() {

    local bRestLength=$[COLUMNS - 14]

    local bRight="$pbRight"
    local bLeftWithoutPath="${pbLeft:s/%~//}"
    local bLeftWithoutPathLength=$(countPChars "$bLeftWithoutPath")

    local maxPathLength=$[bRestLength - bLeftWithoutPathLength]
    bLeft=${pbLeft:s/%~/%(C,%${maxPathLength}<...<%~%<<,)/}

    local bLeftLength=$(countPChars "$bLeft")
    bRestLength=$[bRestLength - bLeftLength]
    local separator="${(l:${bRestLength}:: :)}"
    bLeft="${bLeft}${separator}"

    PROMPT="${bLeft}${bRight}"$'\n'" $pMark "

    psvar=()
    LANG=en_US.UTF-8 vcs_info
    [[ -n "$vcs_info_msg_0_" ]] && psvar[1]="$vcs_info_msg_0_"

    # バージョン管理されているディレクトリにいれば表示，そうでなければ非表示
    RPROMPT="%1(v|%F{green}%1v%f|)"

    SPROMPT="%{[31m%}%r is correct? [n,y,a,e]:%{[m%} "
}

## コマンド実行前に呼び出されるフック。
precmd_functions=($precmd_functions update_prompt)
